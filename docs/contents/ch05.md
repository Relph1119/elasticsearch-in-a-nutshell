# 第5章 Elasticsearch映射

## 5.1 映射定义

- 元字段：
  - 标识字段：`_index`、`_id`
  - 文档源元字段：`_source`（文档正文的原始JSON对象）、`_size`
  - 索引元字段：`_field_names`（文档中包含非空值的所有字段）、`_ignored`
  - 路由元字段：`_routing`（用于将给定文档路由到指定的分片）
  - 其他元字段：`_meta`、`_tier`  
- 数据类型字段：
  - 基本数据类型：`binary`、`boolean`、`keyword`、`number`、`date`、`alias`、`text`
  - 复杂数据类型：数组类型、`JSON`对象类型、嵌套数据类型`Nested`、父子关联类型`Join`、`Flattened`类型  
- 专用数据类型
  - 坐标数据类型
  - IP类型
  - `completion`类型：实现高效的自动补全功能  
- 多字段类型
  - `keyword`：用于精准匹配
  - `standard`：用于全文检索

## 5.2 多表关联方案对比

​    

|   对比   | Nested嵌套类型                     | Join父子文档类型                               | 宽表冗余存储                 | 业务端关联                                   |
| :------: | ---------------------------------- | ---------------------------------------------- | ---------------------------- | -------------------------------------------- |
| 适用场景 | 一对少量、子文档偶尔更新、查询频繁 | 子文档频繁更新                                 | 一对多或者多对多             | 数据量少                                     |
|   优点   | 读取性能高                         | 父子文档可独立更新，互不影响                   | 以空间换时间                 | 数据量少时，用户体验好                       |
|   缺点   | 查询相对较慢                       | Join关系的维护也耗费内存，读取性能比Nested还差 | 字段冗余，造成存储空间的浪费 | 数据量多时，两次查询耗时比较长，影响用户体验 |

## 5.3 详解 null_value

- 接受一个字符串值替换所有显式的空值，默认为`null`。
- 空值不能被索引或搜索。当字段设置为`null`时，将其视为该字段没有值。
- `null_value`必须和定义的数据类型匹配。
- 如果`text`类型想要设置为空值，可以使用`multi_fields`，使用`keyword`和`text`组合类型达到目的。

```edql
PUT my_index_0526
{
  "mappings": {
    "properties": {
      "status_code": {
        "type": "keyword"
      },
      "title": {
        "type": "keyword",
        "fields": {
          "keyword": {
            "type": "keyword",
            "null_value": "NULL"
          }  
        }
      }
    }
  }
}
```
